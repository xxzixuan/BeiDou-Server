import{A as R}from"./index.d4e6d621.js";/* empty css               *//* empty css              *//* empty css              *//* empty css              *//* empty css               */import{t as ee}from"./stringUtils.06f58d77.js";import{u as j}from"./loading.47953f7c.js";import{d as W,j as f,C as i,aE as _,aL as t,aQ as s,aR as p,G as J,aM as e,aF as I,u as P,aY as L,b6 as de,a0 as me,a2 as pe,aX as re,b5 as te,aW as K,bY as _e,b9 as Q,bC as ge,bJ as X,bi as ae,bL as Z,ba as ve,bF as le,D as E,aZ as oe,bG as ne,bH as ue,bK as ie,b2 as fe,bM as he,bN as be}from"./arco.7ab11c03.js";/* empty css               *//* empty css              *//* empty css               */import{g as se}from"./mapleStoryAPI.7ca30bdd.js";import"./chart.35386b55.js";import"./vue.5b3e6270.js";function ce(b){return R.post("/gachapon/v1/getPools",b)}function ye(b){return R.post("/gachapon/v1/updatePool",b)}function ke(b){return R.post("/gachapon/v1/deletePool",b)}function we(b){return R.post("/gachapon/v1/getRewards",b)}function Ce(b){return R.post("/gachapon/v1/updateReward",b)}function Fe(b){return R.post("/gachapon/v1/deleteReward",b)}const Ve={name:"GachaponForm"},De=W({...Ve,emits:["loadData"],setup(b,{expose:S,emit:k}){const{setLoading:V,loading:v}=j(!1),F=f(!1),o=f({}),x=f("\u521B\u5EFA\u5956\u6C60"),z=k,B=async()=>{V(!0);try{await ye(o.value),F.value=!1,L.success("\u5956\u6C60\u5DF2\u4FDD\u5B58"),z("loadData")}finally{V(!1)}},r=()=>{F.value=!1},N=f({gachaponId:void 0,pageNo:1,pageSize:9999}),g=f([]),A=async()=>{V(!0);try{const{data:c}=await ce(N.value);g.value=c.records.filter(u=>u.id!==o.value.id)}finally{V(!1)}};S({initForm:c=>{g.value=[],c?(o.value={id:c.id,name:c.name,gachaponId:c.gachaponId,weight:c.weight,isPublic:c.isPublic,prob:c.prob,startTime:c.startTime,endTime:c.endTime,notification:c.notification,realProb:c.realProb,comment:c.comment},x.value="\u7F16\u8F91\u5956\u6C60",c.gachaponId!==-1&&(N.value.gachaponId=c.gachaponId,A())):(o.value={id:void 0,name:void 0,gachaponId:void 0,weight:void 0,isPublic:!1,prob:void 0,startTime:void 0,endTime:void 0,notification:!1,realProb:void 0,comment:void 0},x.value="\u521B\u5EFA\u5956\u6C60"),F.value=!0}});const T=c=>{let u=0,a=0;for(let m=0;m<g.value.length;m+=1)u+=g.value[m].prob||0,a+=g.value[m].weight||0;a+=o.value.weight||0;const C=1e6-100*u;g.value.forEach(m=>{m.isPublic?m.realProb=(m.prob||0)*100:m.realProb=Math.round(C*(m.weight||0)/a)});for(let m=0;m<g.value.length;m+=1)g.value[m].isPublic?g.value[m].realProb=(g.value[m].prob||0)*100:g.value[m].realProb=Math.round(C*(g.value[m].weight||0)/a);return Math.round(C*c/a)},$=c=>{const u=T(c);return`\u6743\u91CD: ${c} \u6982\u7387 ${u/1e4} %`};return(c,u)=>{const a=de,h=me,C=pe,m=re,w=te,U=K,M=_e,n=Q,d=ge,D=X,Y=ae,H=Z,O=ve,q=le;return i(),_(q,{visible:F.value,"onUpdate:visible":u[10]||(u[10]=l=>F.value=l),"ok-loading":P(v),"on-before-ok":B,width:800,onCancel:r},{title:t(()=>[s(p(x.value),1)]),default:t(()=>[J("div",null,[e(O,{model:o.value},{default:t(()=>[e(a,{label:"\u5956\u6C60ID"},{default:t(()=>[s(p(o.value.id),1)]),_:1}),e(a,{label:"\u516C\u5171\u6C60"},{default:t(()=>[e(m,{modelValue:o.value.isPublic,"onUpdate:modelValue":u[0]||(u[0]=l=>o.value.isPublic=l)},{"checked-icon":t(()=>[e(h)]),"unchecked-icon":t(()=>[e(C)]),_:1},8,["modelValue"])]),_:1}),e(a,{label:"\u5956\u6C60\u540D\u79F0"},{default:t(()=>[e(w,{modelValue:o.value.name,"onUpdate:modelValue":u[1]||(u[1]=l=>o.value.name=l)},null,8,["modelValue"])]),_:1}),o.value.isPublic?I("",!0):(i(),_(a,{key:0,label:"\u767E\u5B9D\u7BB1ID"},{default:t(()=>[e(U,{modelValue:o.value.gachaponId,"onUpdate:modelValue":u[2]||(u[2]=l=>o.value.gachaponId=l)},null,8,["modelValue"])]),_:1})),!o.value.isPublic&&g.value.length>0?(i(),_(a,{key:1,label:"\u6982\u7387"},{default:t(()=>[e(M,{modelValue:o.value.weight,"onUpdate:modelValue":u[3]||(u[3]=l=>o.value.weight=l),min:0,max:1e4,"format-tooltip":$},null,8,["modelValue"])]),_:1})):I("",!0),o.value.isPublic?I("",!0):(i(),_(a,{key:2,label:"\u6743\u91CD"},{default:t(()=>[e(U,{modelValue:o.value.weight,"onUpdate:modelValue":u[4]||(u[4]=l=>o.value.weight=l),max:1e4,min:0,precision:0},null,8,["modelValue"])]),_:1})),o.value.isPublic?(i(),_(a,{key:3,label:"\u56FA\u5B9A\u4E2D\u5956\u7387"},{default:t(()=>[e(n,null,{default:t(()=>[e(U,{modelValue:o.value.prob,"onUpdate:modelValue":u[5]||(u[5]=l=>o.value.prob=l),style:{width:"320px"},placeholder:"\u4E07\u5206\u4E4B","allow-clear":"",precision:0,"hide-button":""},{suffix:t(()=>[s(" /10000 ")]),_:1},8,["modelValue"]),s(" "+p(o.value.prob===void 0?0:o.value.prob/100)+" % ",1)]),_:1})]),_:1})):I("",!0),e(a,{label:"\u751F\u6548\u65F6\u95F4"},{default:t(()=>[e(d,{modelValue:o.value.startTime,"onUpdate:modelValue":u[6]||(u[6]=l=>o.value.startTime=l),style:{width:"220px",margin:"0 24px 24px 0"},"show-time":"",format:"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(a,{label:"\u7ED3\u675F\u65F6\u95F4"},{default:t(()=>[e(d,{modelValue:o.value.endTime,"onUpdate:modelValue":u[7]||(u[7]=l=>o.value.endTime=l),style:{width:"220px",margin:"0 24px 24px 0"},"show-time":"",format:"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(a,{label:"\u5168\u670D\u901A\u77E5"},{default:t(()=>[e(m,{modelValue:o.value.notification,"onUpdate:modelValue":u[8]||(u[8]=l=>o.value.notification=l)},{"checked-icon":t(()=>[e(h)]),"unchecked-icon":t(()=>[e(C)]),_:1},8,["modelValue"])]),_:1}),e(a,{label:"\u5907\u6CE8"},{default:t(()=>[e(w,{modelValue:o.value.comment,"onUpdate:modelValue":u[9]||(u[9]=l=>o.value.comment=l),"max-length":255,"show-word-limit":""},null,8,["modelValue"])]),_:1}),g.value.length>0?(i(),_(H,{key:4,"row-key":"id",loading:P(v),data:g.value,pagination:!1,bordered:{cell:!0}},{columns:t(()=>[e(D,{title:"ID","data-index":"id",width:80,align:"center"}),e(D,{title:"\u540D\u79F0","data-index":"name",align:"center",width:200}),e(D,{title:"\u516C\u5171\u6C60",align:"center",width:120},{cell:t(({record:l})=>[l.isPublic?(i(),_(Y,{key:0,color:"red"},{default:t(()=>[s("\u516C\u5171\u6C60")]),_:1})):(i(),_(Y,{key:1,color:"blue"},{default:t(()=>[s("\u975E\u516C\u5171\u6C60")]),_:1}))]),_:1}),e(D,{title:"\u6743\u91CD","data-index":"weight",align:"center",width:120}),e(D,{title:"\u771F\u5B9E\u6982\u7387",align:"center"},{cell:t(({record:l})=>[s(p(l.realProb/1e4)+" % ",1)]),_:1})]),_:1},8,["loading","data"])):I("",!0)]),_:1},8,["model"])])]),_:1},8,["visible","ok-loading"])}}}),Ie={key:0},$e={key:0},Pe=["src"],Te={key:0},ze={key:0},Be={name:"GachaponRewardForm"},Ue=W({...Be,setup(b,{expose:S}){const{setLoading:k,loading:V}=j(!1),v=f(!1),F=f("\u5956\u54C1\u5217\u8868"),o=f({});S({initForm:y=>{F.value=`[${y.name}] \u5956\u54C1\u5217\u8868`,o.value=y,B(),v.value=!0}});const z=f([]),B=async()=>{k(!0),r.value=-1;try{const{data:y}=await we(o.value);z.value=y}finally{k(!1)}},r=f(-1),N=async y=>{k(!0);try{await Ce(y),L.success("\u5956\u54C1\u5DF2\u4FDD\u5B58"),await B()}finally{k(!1)}},g=()=>{z.value.unshift({poolId:o.value.id,quantity:1}),r.value=void 0},A=async y=>{k(!0);try{await Fe(y),L.success("\u5956\u54C1\u5DF2\u5220\u9664"),await B()}finally{k(!1)}};return(y,T)=>{const $=oe,c=Q,u=ne,a=ue,h=X,C=K,m=te,w=ie,U=Z,M=le;return i(),_(M,{visible:v.value,"onUpdate:visible":T[1]||(T[1]=n=>v.value=n),width:1e3,"ok-loading":P(V)},{title:t(()=>[s(p(F.value),1)]),default:t(()=>[e(a,null,{default:t(()=>[e(u,null,{default:t(()=>[e(c,null,{default:t(()=>[e($,{type:"primary",onClick:g},{default:t(()=>[s("\u65B0\u5EFA")]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{"row-key":"id",loading:P(V),data:z.value,"column-resizable":"",pagination:!1,bordered:{cell:!0},scroll:{y:600}},{columns:t(()=>[e(h,{title:"ID","data-index":"id",width:120,align:"center"}),e(h,{title:"\u5956\u6C60ID","data-index":"poolId",width:120,align:"center"}),e(h,{title:"\u7269\u54C1ID",width:140,align:"center"},{cell:t(({record:n})=>[r.value!==n.id?(i(),E("span",Ie,p(n.itemId),1)):(i(),_(C,{key:1,modelValue:n.itemId,"onUpdate:modelValue":d=>n.itemId=d},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),e(h,{title:"\u7269\u54C1\u540D\u79F0",width:140,align:"center"},{cell:t(({record:n})=>[r.value!==n.id?(i(),E("span",$e,p(n.itemName),1)):(i(),_(C,{key:1,modelValue:n.itemId,"onUpdate:modelValue":d=>n.itemId=d},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),e(h,{title:"\u7269\u54C1\u56FE\u6807",width:140,align:"center"},{cell:t(({record:n})=>[J("img",{src:P(se)("item",n.itemId),alt:""},null,8,Pe)]),_:1}),e(h,{title:"\u6570\u91CF",width:120,align:"center"},{cell:t(({record:n})=>[r.value!==n.id?(i(),E("span",Te,p(n.quantity),1)):(i(),_(C,{key:1,modelValue:n.quantity,"onUpdate:modelValue":d=>n.quantity=d},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),e(h,{title:"\u5907\u6CE8"},{cell:t(({record:n})=>[r.value!==n.id?(i(),E("span",ze,p(n.comment),1)):(i(),_(m,{key:1,modelValue:n.comment,"onUpdate:modelValue":d=>n.comment=d},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),e(h,{title:"\u64CD\u4F5C"},{cell:t(({record:n})=>[r.value!==n.id?(i(),_($,{key:0,type:"text",size:"mini",onClick:d=>r.value=n.id},{default:t(()=>[s(" \u7F16\u8F91 ")]),_:2},1032,["onClick"])):I("",!0),r.value!==n.id?(i(),_(w,{key:1,type:"error",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u5956\u54C1\u5417\uFF1F",onOk:d=>A(n)},{default:t(()=>[e($,{size:"mini",status:"danger",type:"text"},{default:t(()=>[s(" \u5220\u9664 ")]),_:1})]),_:2},1032,["onOk"])):I("",!0),r.value===n.id?(i(),_($,{key:2,type:"text",size:"mini",onClick:d=>N(n)},{default:t(()=>[s(" \u4FDD\u5B58 ")]),_:2},1032,["onClick"])):I("",!0),r.value===n.id?(i(),_($,{key:3,type:"text",size:"mini",onClick:T[0]||(T[0]=d=>r.value=-1)},{default:t(()=>[s(" \u53D6\u6D88 ")]),_:1})):I("",!0)]),_:1})]),_:1},8,["loading","data"])]),_:1},8,["visible","ok-loading"])}}}),Ee={class:"container"},xe=["src"],Ne={key:0},Re={key:0},Se={name:"Gachapon"},et=W({...Se,setup(b){const{loading:S,setLoading:k}=j(!1),V=f([]),v=f({gachaponId:void 0,pageNo:1,pageSize:20}),F=f(0),o=f(void 0),x=f(void 0),z=a=>{v.value.pageNo=a,r()},B=a=>{v.value.pageNo=1,v.value.pageSize=a,r()},r=async()=>{k(!0);try{const{data:a}=await ce(v.value);V.value=a.records,F.value=a.totalRow,o.value=v.value.gachaponId,x.value=void 0}finally{k(!1)}};r();const N=()=>{v.value={gachaponId:void 0,pageNo:1,pageSize:20},r()},g=a=>{v.value={gachaponId:a,pageNo:1,pageSize:20},r()},A=async a=>{k(!0);try{await ke(a),L.success("\u5956\u6C60\u5DF2\u5220\u9664"),await r()}finally{k(!1)}},y=f(),T=()=>{y.value.initForm()},$=a=>{y.value.initForm(a)},c=f(),u=a=>{c.value.initForm(a)};return(a,h)=>{const C=fe("Breadcrumb"),m=K,w=oe,U=Q,M=ne,n=ue,d=X,D=ae,Y=ie,H=Z,O=he,q=be;return i(),E("div",Ee,[e(C),e(q,{class:"general-card",title:a.$t("menu.game.gachapon")},{default:t(()=>[e(n,null,{default:t(()=>[e(M,null,{default:t(()=>[e(U,null,{default:t(()=>[e(m,{modelValue:v.value.gachaponId,"onUpdate:modelValue":h[0]||(h[0]=l=>v.value.gachaponId=l),placeholder:a.$t("gachapon.placeholder.gachaponId")},null,8,["modelValue","placeholder"]),e(w,{type:"primary",onClick:r},{default:t(()=>[s(p(a.$t("button.search")),1)]),_:1}),e(w,{onClick:N},{default:t(()=>[s(p(a.$t("button.reset")),1)]),_:1}),e(w,{type:"primary",status:"success",onClick:T},{default:t(()=>[s(p(a.$t("button.create")),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(H,{"row-key":"id",loading:P(S),data:V.value,"column-resizable":"",pagination:!1,bordered:{cell:!0}},{columns:t(()=>[e(d,{title:"ID","data-index":"id",width:80,align:"center",fixed:"left"}),e(d,{title:a.$t("gachapon.list.column.name"),"data-index":"name",align:"center",width:200,fixed:"left"},null,8,["title"]),e(d,{title:a.$t("gachapon.list.column.gachaponId"),align:"center",width:120},{cell:t(({record:l})=>[e(w,{size:"mini",type:"text",onClick:G=>g(l.gachaponId)},{default:t(()=>[s(p(l.gachaponId),1)]),_:2},1032,["onClick"])]),_:1},8,["title"]),e(d,{title:a.$t("gachapon.list.column.gachaponName"),align:"center",width:120},{cell:t(({record:l})=>[s(p(l.gachaponName),1)]),_:1},8,["title"]),e(d,{title:a.$t("gachapon.list.column.gachaponPhoto"),align:"center",width:120},{cell:t(({record:l})=>[J("img",{src:P(se)("npc",l.gachaponId)},null,8,xe)]),_:1},8,["title"]),e(d,{title:a.$t("gachapon.list.column.isPublic"),align:"center",width:120},{cell:t(({record:l})=>[l.isPublic?(i(),_(D,{key:0,color:"red"},{default:t(()=>[s(p(a.$t("gachapon.isPublic.true.desc")),1)]),_:1})):(i(),_(D,{key:1,color:"blue"},{default:t(()=>[s(p(a.$t("gachapon.isPublic.false.desc")),1)]),_:1}))]),_:1},8,["title"]),e(d,{title:a.$t("gachapon.list.column.isPublic"),align:"center",width:120},{cell:t(({record:l})=>[o.value!==void 0&&o.value!==-1?(i(),E("span",Ne,p(l.realProb/1e4)+" % ",1)):I("",!0)]),_:1},8,["title"]),e(d,{title:a.$t("gachapon.list.column.startTime"),align:"center",width:230},{cell:t(({record:l})=>[s(p(l.startTime!=null?P(ee)(l.startTime):a.$t("gachapon.startTime.default")),1)]),_:1},8,["title"]),e(d,{title:a.$t("gachapon.list.column.endTime"),align:"center",width:230},{cell:t(({record:l})=>[s(p(l.endTime!=null?P(ee)(l.endTime):a.$t("gachapon.endTime.default")),1)]),_:1},8,["title"]),e(d,{title:a.$t("gachapon.list.column.notification"),"data-index":"notification",align:"center",width:120},{cell:t(({record:l})=>[l.notification?(i(),_(D,{key:0,color:"green"},{default:t(()=>[s(p(a.$t("gachapon.notification.true.desc")),1)]),_:1})):(i(),_(D,{key:1,color:"red"},{default:t(()=>[s(p(a.$t("gachapon.notification.false.desc")),1)]),_:1}))]),_:1},8,["title"]),e(d,{title:a.$t("gachapon.list.column.comment"),"data-index":"comment",width:400,align:"center"},null,8,["title"]),e(d,{title:a.$t("operation"),width:220,align:"center",fixed:"right"},{cell:t(({record:l})=>[o.value!=null?(i(),E("div",Re,[e(w,{size:"mini",type:"text",onClick:G=>$(l)},{default:t(()=>[s(p(a.$t("button.edit")),1)]),_:2},1032,["onClick"]),e(w,{size:"mini",type:"text",onClick:G=>u(l)},{default:t(()=>[s(p(a.$t("gachapon.button.detail")),1)]),_:2},1032,["onClick"]),e(Y,{type:"error",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u5956\u6C60\u5417\uFF1F",onOk:G=>A(l)},{default:t(()=>[e(w,{size:"mini",status:"danger",type:"text"},{default:t(()=>[s(p(a.$t("button.delete")),1)]),_:1})]),_:2},1032,["onOk"])])):(i(),_(w,{key:1,size:"mini",type:"text",onClick:G=>g(l.gachaponId)},{default:t(()=>[s(p(a.$t("gachapon.button.operate")),1)]),_:2},1032,["onClick"]))]),_:1},8,["title"])]),_:1},8,["loading","data"]),e(O,{style:{"margin-top":"20px"},total:F.value,"page-size":v.value.pageSize,current:v.value.pageNo,"show-total":"","show-jumper":"","show-page-size":"","page-size-options":[20,40,60,100],onChange:z,onPageSizeChange:B},null,8,["total","page-size","current"])]),_:1},8,["title"]),e(De,{ref_key:"gachaponForm",ref:y,onLoadData:r},null,512),e(Ue,{ref_key:"gachaponRewardForm",ref:c},null,512)])}}});export{et as default};
