import{v as z,B as A}from"./index.d4e6d621.js";/* empty css              *//* empty css              *//* empty css              *//* empty css               */import{u as J}from"./loading.47953f7c.js";/* empty css               */import{d as K,j as S,r as X,o as x,b2 as ee,C as u,D as $,aM as t,aL as a,aQ as r,aR as l,aE as b,aO as D,aN as E,u as V,bv as F,G as h,aY as p,bi as ae,bG as te,bH as oe,bN as se,aZ as ne,b9 as le,bF as re,aW as ie,bj as de,b5 as ue,b8 as ce,ba as pe}from"./arco.7ab11c03.js";import{a as me,r as fe,s as we,b as ge,c as be}from"./dashboard.8674b060.js";import{f as he}from"./vue.5b3e6270.js";import{r as _e,a as ve,b as ke}from"./command.52d79e81.js";import"./chart.35386b55.js";const Ce=["loading"],Me={style:{"line-height":"32px","text-align":"right"}},ye={style:{display:"flex","align-items":"center"}},Se={name:"Dashboard"},Te=K({...Se,setup($e){const{t:c}=z.exports.useI18n(),{loading:_,setLoading:i}=J(!1),v=S("resting"),m=S(!1),f=S(!1);he();const s=X({minutes:0,shutdownMsg:"",showServerMsg:!1,showCenterMsg:!1,showChatMsg:!1}),N=[{label:"start",action:"start",disabled:e=>e==="running",status:"success",icon:"icon-play-arrow-fill"},{label:"stop",action:"stop",disabled:e=>e==="resting",status:"danger",icon:"icon-stop"},{label:"restart",action:"restart",disabled:e=>e==="resting",status:"warning",icon:"icon-refresh"},{label:"shutdown",action:"shutdown",disabled:()=>!1,status:"danger",icon:"icon-poweroff"}],P=[{label:"dataReloadEvents",action:"reloadEvents",icon:"icon-compass"},{label:"dataReloadMaps",action:"reloadMaps",icon:"icon-mind-mapping"},{label:"dataReloadPortals",action:"reloadPortals",icon:"icon-common"}],w=async()=>{i(!0);try{const{data:e}=await me();v.value=e?"running":"resting"}finally{i(!1)}};x(()=>{w()});const B=async e=>{if(e==="shutdown"){f.value=!0;return}i(!0);try{switch(e){case"start":await we();break;case"stop":m.value=!0,i(!1);return;case"restart":await fe();break;case"reloadEvents":await ke();break;case"reloadMaps":await ve();break;case"reloadPortals":await _e();break;default:break}p.success(c("common.operationSuccess"))}catch(n){console.error(n),p.error(c("common.requestFailed"))}finally{await w(),i(!1)}},G=async()=>{try{i(!0),await ge(),p.success(c("workplace.button.shutdown.success")),await w()}catch(e){console.error(e),p.error(c("common.requestFailed"))}finally{f.value=!1,i(!1)}},O=()=>{f.value=!1},T=async()=>{try{i(!0);const e={minutes:s.minutes,shutdownMsg:s.shutdownMsg,showServerMsg:s.showServerMsg,showCenterMsg:s.showCenterMsg,showChatMsg:s.showChatMsg};await be(e),p.success(c("workplace.stop.shutdownInProgress")),s.minutes>0?setTimeout(async()=>{await w()},s.minutes*60*1e3):await w(),m.value=!1}catch(e){console.error(e),p.error(c("common.requestFailed"))}finally{i(!1)}},j=()=>{Object.assign(s,{minutes:0,shutdownMsg:"",showServerMsg:!1,showCenterMsg:!1,showChatMsg:!1}),m.value=!1};return(e,n)=>{const L=ee("Breadcrumb"),R=ae,g=te,k=oe,d=se,I=ne,C=le,U=re,q=ie,H=A,Q=de,W=ue,M=ce,Y=pe;return u(),$("div",{class:"container",loading:V(_)},[t(L),t(d,{class:"general-card",title:e.$t("menu.dashboard.workplace")},{default:a(()=>[t(d,{class:"status-card",title:e.$t("workplace.gameServer.status"),bordered:!1},{default:a(()=>[t(k,null,{default:a(()=>[t(g,null,{default:a(()=>[r(l(e.$t("workplace.gameServer.currently"))+" ",1),v.value==="running"?(u(),b(R,{key:0,color:"green",bordered:""},{default:a(()=>[r(l(e.$t("workplace.running")),1)]),_:1})):(u(),b(R,{key:1,color:"gray",bordered:""},{default:a(()=>[r(l(e.$t("workplace.stopped")),1)]),_:1}))]),_:1})]),_:1})]),_:1},8,["title"]),t(d,{class:"control-card",title:e.$t("workplace.gameServer.serverControl"),bordered:!1},{default:a(()=>[t(C,null,{default:a(()=>[(u(),$(D,null,E(N,(o,y)=>t(I,{key:y,loading:V(_)&&o.action!=="stop",type:"primary",disabled:o.disabled(v.value),status:o.status,onClick:Z=>B(o.action)},{icon:a(()=>[(u(),b(F(o.icon)))]),default:a(()=>[r(" "+l(e.$t(`workplace.button.${o.label}`)),1)]),_:2},1032,["loading","disabled","status","onClick"])),64))]),_:1})]),_:1},8,["title"]),t(d,{class:"reload-card",title:e.$t("workplace.dataReload"),bordered:!1},{default:a(()=>[t(C,null,{default:a(()=>[(u(),$(D,null,E(P,(o,y)=>t(I,{key:y+"reload",loading:V(_),type:"primary",onClick:Z=>B(o.action)},{icon:a(()=>[(u(),b(F(o.icon)))]),default:a(()=>[r(" "+l(e.$t(`workplace.button.${o.label}`)),1)]),_:2},1032,["loading","onClick"])),64))]),_:1})]),_:1},8,["title"]),t(U,{visible:f.value,"onUpdate:visible":n[0]||(n[0]=o=>f.value=o),width:400,onOk:G,onCancel:O},{title:a(()=>[r(l(e.$t("workplace.button.shutdown")),1)]),default:a(()=>[h("p",null,l(e.$t("workplace.button.shutdown.confirm")),1)]),_:1},8,["visible"]),t(U,{visible:m.value,"onUpdate:visible":n[6]||(n[6]=o=>m.value=o),width:600,draggable:"",onOk:T,onCancel:j},{title:a(()=>[r(l(e.$t("workplace.button.stop.config")),1)]),default:a(()=>[t(Y,{model:s,layout:"vertical"},{default:a(()=>[t(d,{title:e.$t("workplace.stop.minutes"),bordered:!1,style:{"margin-bottom":"16px"}},{default:a(()=>[t(k,{gutter:[16,16]},{default:a(()=>[t(g,{span:18},{default:a(()=>[t(q,{modelValue:s.minutes,"onUpdate:modelValue":n[1]||(n[1]=o=>s.minutes=o),min:0},null,8,["modelValue"])]),_:1}),t(g,{span:6},{default:a(()=>[h("span",Me,l(e.$t("workplace.unit.minutes")),1)]),_:1})]),_:1})]),_:1},8,["title"]),t(d,{bordered:!1,style:{"margin-bottom":"16px"}},{title:a(()=>[h("div",ye,[h("span",null,l(e.$t("workplace.stop.shutdownMsg")),1),t(Q,{content:e.$t("workplace.stop.shutdownMsgDefault")},{default:a(()=>[t(H,{style:{"margin-left":"8px"}})]),_:1},8,["content"])])]),default:a(()=>[t(k,{gutter:[16,16]},{default:a(()=>[t(g,{span:24},{default:a(()=>[t(W,{modelValue:s.shutdownMsg,"onUpdate:modelValue":n[2]||(n[2]=o=>s.shutdownMsg=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(d,{title:e.$t("workplace.stop.messageTypes"),bordered:!1},{default:a(()=>[t(C,null,{default:a(()=>[t(M,{modelValue:s.showServerMsg,"onUpdate:modelValue":n[3]||(n[3]=o=>s.showServerMsg=o)},{default:a(()=>[r(l(e.$t("workplace.stop.showServerMsg")),1)]),_:1},8,["modelValue"]),t(M,{modelValue:s.showCenterMsg,"onUpdate:modelValue":n[4]||(n[4]=o=>s.showCenterMsg=o)},{default:a(()=>[r(l(e.$t("workplace.stop.showCenterMsg")),1)]),_:1},8,["modelValue"]),t(M,{modelValue:s.showChatMsg,"onUpdate:modelValue":n[5]||(n[5]=o=>s.showChatMsg=o)},{default:a(()=>[r(l(e.$t("workplace.stop.showChatMsg")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title"])]),_:1},8,["model"])]),_:1},8,["visible"])]),_:1},8,["title"])],8,Ce)}}});export{Te as default};
